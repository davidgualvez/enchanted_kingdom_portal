$(document).ready(function(){ 
 	console.log('test');  

 	$('.question.circle.outline.icon')
 	  .popup({
 	    on: 'click'
 	});

 	checkOut();
 	order();
 	// checkOutReward(); 
	 ontest();
	 
	//  setTimeout(() => {
	// 	 initGuide();
	//  }, 500);
});
 

function checkOut(){
	$('#checkout').on('click',function(){ 

		//$('#checkout').attr('disabled', 'disabled'); 
		disableButton();

		$.confirm({
		    title: 'Confirmation!',
		    content: 'Purchase confirmation, do you want to continue?',
		    type: 'dark',
		    boxWidth: '80%',
    		useBootstrap: false, 
    		closeIcon: function(){
    		        //return false; // to prevent close the modal.
    		        // or
    		        //return 'aRandomButton'; // set a button handler, 'aRandomButton' prevents close.
    		        enableButton();
    		    },
		    buttons: { 
		        // cancel: function () {
		        //     //$.alert('Canceled!');
		        //     //$('#checkout').removeAttr('disabled', 'disabled');
		        //     enableButton();
		        // },
		        somethingElse: {
		            text: 'Confirm',
		            btnClass: 'btn-green',
		            keys: ['enter', 'shift'],
		            action: function(){
		            	
		               //$.alert('Confirmed!'); 

		               var points_payment = $('#points_payment').val();
		               //$('#checkout').removeAttr('disabled', 'disabled'); 

		               post(routes.cart.checkout, {
		               	points_payment : points_payment
		               }, function(response){
			               	console.log(response);
			               	if(response.success == false){
			               		showError('Error',response.message, function(){

			               		});


			               		//$('#checkout').removeAttr('disabled', 'disabled');
			               		enableButton();
			               		return;
			               	}
			               	 
			               	showSuccess('Success','Your Purchase has been checkout!.', function(){
			               		redirectTo('/me');
			               	});
		               });

		            }
		        }
		    }
		});

	});
}

function order(){
	$('#order').on('click', function(){
		disableButton(); 
		$.confirm({
		    title: 'Confirmation!',
		    content: 'Order confirmation, do you want to continue?',
		    type: 'dark',
		    boxWidth: '80%',
    		useBootstrap: false,
    		closeIcon: function(){
    		        //return false; // to prevent close the modal.
    		        // or
    		        //return 'aRandomButton'; // set a button handler, 'aRandomButton' prevents close.
    		        enableButton();
    		    },
		    buttons: { 
		        // cancel: function () { 
		        //     enableButton();
		        // },
		        
		        somethingElse: {
		            text: 'Confirm',
		            btnClass: 'btn-green',
		            keys: ['enter', 'shift'],
		            action: function(){

		            	post(routes.cart.order, {}, function(response){ 
		            		console.log(response);
		            		if(response.success == false){
			               		showError('Error',response.message, function(){

			               		});  
			               		enableButton();
			               		return;
			               	}

		            		showSuccess('Success','Your Order has been checkout!.', function(){
			               		redirectTo('/order/history');
			               	});
		            	});
		            	
		            }
		        }
		    }
		});
	});
}

function ontest(){
	$('#points_payment').keyup(function(){
		var value = this.value;
		value = value.replace(/\D+/g, "");

		//console.log(value);
		this.value = value;
		this.focus();

	});
}

function disableButton(){
	$('#checkout').attr('disabled', 'disabled'); 
	$('#order').attr('disabled', 'disabled'); 
}

function enableButton(){
	$('#checkout').removeAttr('disabled', 'disabled');
	$('#order').removeAttr('disabled', 'disabled');
}


//GUIDE FOR THIS PAGE
function initGuide() {
    if (getStorage('guide-cart') != 1) {
        startGuide();
    }
}

function startGuide() {
    var intro = introJs();
    intro.setOptions({
        steps: [
            {
                element: '.step1',
                intro: 'This area shows all the items added while you are at the store page',
            },
            {
                element: '.step2',
                intro: 'This field is use to pay using your points. if there is a balance your wallet will be automatically deducted.',
                position: 'left'
            },
            {
                element: '.step3',
                intro: 'If you choose this Order button, you need to go to the nearest POS and present a QRCode generated by the system after this transaction.',
            },
            {
                element: '.step4',
                intro: 'If you choose thise Purchase button, Your wallet and Points(optional) will be automatically deducted if the Transaction was successful.',
            },
        ]
    });

    intro.onexit(function () {
        setStorage('guide-cart', 1);
        console.log('exit');
    });
    intro.start();
}